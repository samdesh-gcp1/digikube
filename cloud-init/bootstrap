#!/bin/bash
# bootstrap script
# Input parameters
#	$1 => digikube code repository url
#	$2 => digikube config file (either url or local file)
#	$3 => command (either create or delete)
#	$4 => forced (only in case of delete...)

clear

if [[ ${#} -lt 4 ]]; then
	echo "ERROR: Insufficient input parameters provided."
	exit 1
else
	digikubeCodeRepo="${1}"
	digikubeConfigFileRef="${2}"
	bootstrapCommand="${3}"
	isForced="${4}"
	
	tmpExecDir=$(mktemp -d --suffix="-digikube")
	
	if [[ "${bootstrapCommand}" == "create" ]]; then
		wget -q --no-cache -O "${tmpExecDir}/gce-cloud-init" - "${digikubeCodeRepo}/cloud-init/gce-cloud-init" 
		chmod +x "${tmpExecDir}/gce-cloud-init"
		"${tmpExecDir}/gce-cloud-init" "${digikubeCodeRepo}" "${digikubeConfigFileRef}"
	else
		echo "Please enter delete scope:"
		echo "            Only K8S Cluster                                   : cluster"
		echo "            K8S Cluster with bastion host                      : bastion-host"
		echo "            K8S Cluster, bastion-host, cloud-resourses         : all"
		echo "            K8S Cluster, bastion-host, cloud-resources, bucket : all-with-bucket"
		
		read -p "Enter your choice: " deleteChoice
		wget -q --no-cache -O "${tmpExecDir}/gce-cloud-delete" - "${digikubeCodeRepo}/cloud-init/gce-cloud-delete"
		chmod +x "${tmpExecDir}/gce-cloud-delete"
		"${tmpExecDir}/gce-cloud-delete" "${digikubeCodeRepo}" "${digikubeConfigFileRef}" "${deleteChoice}" "${isForced}"
	fi
fi
